name: Deploy MegaTetris to GitHub Pages

# è§¦å‘æ¡ä»¶ï¼šæ¨é€åˆ° main/master åˆ†æ”¯æ—¶è‡ªåŠ¨éƒ¨ç½²
on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

# å…è®¸æ‰‹åŠ¨è§¦å‘ workflow
  workflow_dispatch:

# è®¾ç½® GITHUB_TOKEN æƒé™
permissions:
  contents: read
  pages: write
  id-token: write

# ç¡®ä¿åŒæ—¶åªæœ‰ä¸€ä¸ªéƒ¨ç½²åœ¨è¿è¡Œ
concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  # æ„å»ºä½œä¸š
  build:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: ğŸ”§ é…ç½® GitHub Pages
        uses: actions/configure-pages@v4

      - name: ğŸ“¦ å‡†å¤‡éƒ¨ç½²æ–‡ä»¶
        run: |
          echo "ğŸ® MegaTetris æ¸¸æˆæ–‡ä»¶å‡†å¤‡ä¸­..."
          
          # æ£€æŸ¥å¿…è¦æ–‡ä»¶æ˜¯å¦å­˜åœ¨
          echo "âœ… æ£€æŸ¥æ ¸å¿ƒæ–‡ä»¶:"
          ls -la index.html main.js style.css
          
          echo "âœ… æ£€æŸ¥æ¸¸æˆæ¨¡å—:"
          ls -la js/
          
          echo "âœ… éªŒè¯ ES6 æ¨¡å—è¯­æ³•"
          grep -n "import.*from" main.js || echo "âš ï¸  æœªæ‰¾åˆ° ES6 import è¯­å¥"
          grep -n "export.*default" js/*.js || echo "âš ï¸  æœªæ‰¾åˆ° ES6 export è¯­å¥"
          
          echo "ğŸš€ æ‰€æœ‰æ–‡ä»¶å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥éƒ¨ç½²ï¼"

      - name: ğŸ“‚ ä¸Šä¼ æ„å»ºäº§ç‰©
        uses: actions/upload-pages-artifact@v3
        with:
          # ä¸Šä¼ æ•´ä¸ªé¡¹ç›®æ ¹ç›®å½•ï¼ˆå› ä¸ºæ˜¯çº¯é™æ€æ–‡ä»¶ï¼‰
          path: '.'

  # éƒ¨ç½²ä½œä¸š
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: ğŸš€ éƒ¨ç½²åˆ° GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4

      - name: ğŸ‰ éƒ¨ç½²å®Œæˆé€šçŸ¥
        run: |
          echo "ğŸ® MegaTetris å·²æˆåŠŸéƒ¨ç½²åˆ° GitHub Pages!"
          echo "ğŸŒ è®¿é—®åœ°å€: ${{ steps.deployment.outputs.page_url }}"
          echo "ï¿½ï¿½ ç°åœ¨å¯ä»¥åœ¨çº¿ç•…ç©ä¿„ç½—æ–¯æ–¹å—äº†ï¼" 